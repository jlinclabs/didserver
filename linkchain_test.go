package main

import (
	"database/sql"
	"log"
	"testing"

	"github.com/BurntSushi/toml"
	_ "github.com/lib/pq"
)

func TestLinkchainCommit(t *testing.T) {
	type Chaintest struct {
		id  string
		did string
	}
	var chaintests []Chaintest

	chaintests = append(chaintests, Chaintest{id: "did:jlinc:5dSUCkRheksiADwIpSo2MZ7cuXb2rSuSjPgsJy0Ru70", did: `{"did":{"@context":"https://w3id.org/did/v1","created":"2019-01-11T01:08:54.207Z","id":"did:jlinc:5dSUCkRheksiADwIpSo2MZ7cuXb2rSuSjPgsJy0Ru70","publicKey":[{"id":"did:jlinc:5dSUCkRheksiADwIpSo2MZ7cuXb2rSuSjPgsJy0Ru70#signing","owner":"did:jlinc:5dSUCkRheksiADwIpSo2MZ7cuXb2rSuSjPgsJy0Ru70","publicKeyBase64":"5dSUCkRheksiADwIpSo2MZ7cuXb2rSuSjPgsJy0Ru70","type":"ed25519"},{"id":"did:jlinc:5dSUCkRheksiADwIpSo2MZ7cuXb2rSuSjPgsJy0Ru70#encrypting","owner":"did:jlinc:5dSUCkRheksiADwIpSo2MZ7cuXb2rSuSjPgsJy0Ru70","publicKeyBase64":"_8qenYnU5U0H3HWjoEsTGkd4k5OYbAcW472-8dnsJBw","type":"curve25519"}]}}`})
	chaintests = append(chaintests, Chaintest{id: "did:jlinc:AvdJAL8yXHTEBCh52V_kNO1fTtWejeQdbFLZ-SRVd00", did: `{"did":{"@context":"https://w3id.org/did/v1","created":"2019-01-11T01:09:05.971Z","id":"did:jlinc:AvdJAL8yXHTEBCh52V_kNO1fTtWejeQdbFLZ-SRVd00","publicKey":[{"id":"did:jlinc:AvdJAL8yXHTEBCh52V_kNO1fTtWejeQdbFLZ-SRVd00#signing","owner":"did:jlinc:AvdJAL8yXHTEBCh52V_kNO1fTtWejeQdbFLZ-SRVd00","publicKeyBase64":"AvdJAL8yXHTEBCh52V_kNO1fTtWejeQdbFLZ-SRVd00","type":"ed25519"},{"id":"did:jlinc:AvdJAL8yXHTEBCh52V_kNO1fTtWejeQdbFLZ-SRVd00#encrypting","owner":"did:jlinc:AvdJAL8yXHTEBCh52V_kNO1fTtWejeQdbFLZ-SRVd00","publicKeyBase64":"2WOVndk6gqtZEdo4lZ5a36j-vKpuB5C1kIXHCZ-E5Us","type":"curve25519"}]}}`})
	chaintests = append(chaintests, Chaintest{id: "did:jlinc:6RWvdkza3gJz2tLKq7OhemFU-B_-v4Bz9Vk8wfl9vzs", did: `{"did":{"@context":"https://w3id.org/did/v1","created":"2019-01-11T01:09:09.558Z","id":"did:jlinc:6RWvdkza3gJz2tLKq7OhemFU-B_-v4Bz9Vk8wfl9vzs","publicKey":[{"id":"did:jlinc:6RWvdkza3gJz2tLKq7OhemFU-B_-v4Bz9Vk8wfl9vzs#signing","owner":"did:jlinc:6RWvdkza3gJz2tLKq7OhemFU-B_-v4Bz9Vk8wfl9vzs","publicKeyBase64":"6RWvdkza3gJz2tLKq7OhemFU-B_-v4Bz9Vk8wfl9vzs","type":"ed25519"},{"id":"did:jlinc:6RWvdkza3gJz2tLKq7OhemFU-B_-v4Bz9Vk8wfl9vzs#encrypting","owner":"did:jlinc:6RWvdkza3gJz2tLKq7OhemFU-B_-v4Bz9Vk8wfl9vzs","publicKeyBase64":"naVZDrm35fXG8VoyAg5NdOJfAGawlBMbdtKNqbZ4H34","type":"curve25519"}]}}`})
	chaintests = append(chaintests, Chaintest{id: "did:jlinc:A2h6m0YHBhcHB0QvN8RTiYaXXPx3ac8ucImL4BPiEoA", did: `{"did":{"@context":"https://w3id.org/did/v1","created":"2019-01-11T01:09:13.539Z","id":"did:jlinc:A2h6m0YHBhcHB0QvN8RTiYaXXPx3ac8ucImL4BPiEoA","publicKey":[{"id":"did:jlinc:A2h6m0YHBhcHB0QvN8RTiYaXXPx3ac8ucImL4BPiEoA#signing","owner":"did:jlinc:A2h6m0YHBhcHB0QvN8RTiYaXXPx3ac8ucImL4BPiEoA","publicKeyBase64":"A2h6m0YHBhcHB0QvN8RTiYaXXPx3ac8ucImL4BPiEoA","type":"ed25519"},{"id":"did:jlinc:A2h6m0YHBhcHB0QvN8RTiYaXXPx3ac8ucImL4BPiEoA#encrypting","owner":"did:jlinc:A2h6m0YHBhcHB0QvN8RTiYaXXPx3ac8ucImL4BPiEoA","publicKeyBase64":"lAV4OnFUB2nDwpUOlViLW2pnsUluSD0M1GuJUVLxpC8","type":"curve25519"}]}}`})
	chaintests = append(chaintests, Chaintest{id: "did:jlinc:85axa3qK4Bi3-fw7hx5X1nMkmNMZFRv1hE3ysSmO6Rs", did: `{"did":{"@context":"https://w3id.org/did/v1","created":"2019-01-11T01:09:20.645Z","id":"did:jlinc:85axa3qK4Bi3-fw7hx5X1nMkmNMZFRv1hE3ysSmO6Rs","publicKey":[{"id":"did:jlinc:85axa3qK4Bi3-fw7hx5X1nMkmNMZFRv1hE3ysSmO6Rs#signing","owner":"did:jlinc:85axa3qK4Bi3-fw7hx5X1nMkmNMZFRv1hE3ysSmO6Rs","publicKeyBase64":"85axa3qK4Bi3-fw7hx5X1nMkmNMZFRv1hE3ysSmO6Rs","type":"ed25519"},{"id":"did:jlinc:85axa3qK4Bi3-fw7hx5X1nMkmNMZFRv1hE3ysSmO6Rs#encrypting","owner":"did:jlinc:85axa3qK4Bi3-fw7hx5X1nMkmNMZFRv1hE3ysSmO6Rs","publicKeyBase64":"Abf1LY5AHgS0yZST0DbYoOHDcK2bHJSsDkFCGjZRe0c","type":"curve25519"}]}}`})
	chaintests = append(chaintests, Chaintest{id: "did:jlinc:H-z4_C73XY8OJJh1Vissv2fC7saL-JzV9VjGRhA7kD8", did: `{"did":{"@context":"https://w3id.org/did/v1","created":"2019-01-11T01:09:27.234Z","id":"did:jlinc:H-z4_C73XY8OJJh1Vissv2fC7saL-JzV9VjGRhA7kD8","publicKey":[{"id":"did:jlinc:H-z4_C73XY8OJJh1Vissv2fC7saL-JzV9VjGRhA7kD8#signing","owner":"did:jlinc:H-z4_C73XY8OJJh1Vissv2fC7saL-JzV9VjGRhA7kD8","publicKeyBase64":"H-z4_C73XY8OJJh1Vissv2fC7saL-JzV9VjGRhA7kD8","type":"ed25519"},{"id":"did:jlinc:H-z4_C73XY8OJJh1Vissv2fC7saL-JzV9VjGRhA7kD8#encrypting","owner":"did:jlinc:H-z4_C73XY8OJJh1Vissv2fC7saL-JzV9VjGRhA7kD8","publicKeyBase64":"3DzX_nqMzIdaV_ptYD0Id-6SVTqkFCIl0jJMYBl8oRk","type":"curve25519"}]}}`})
	chaintests = append(chaintests, Chaintest{id: "did:jlinc:OaFTHXfHuPHg2QQobY7ANNPHUCLemur67QJlr8VPuhw", did: `{"did":{"@context":"https://w3id.org/did/v1","created":"2019-01-11T01:09:29.121Z","id":"did:jlinc:OaFTHXfHuPHg2QQobY7ANNPHUCLemur67QJlr8VPuhw","publicKey":[{"id":"did:jlinc:OaFTHXfHuPHg2QQobY7ANNPHUCLemur67QJlr8VPuhw#signing","owner":"did:jlinc:OaFTHXfHuPHg2QQobY7ANNPHUCLemur67QJlr8VPuhw","publicKeyBase64":"OaFTHXfHuPHg2QQobY7ANNPHUCLemur67QJlr8VPuhw","type":"ed25519"},{"id":"did:jlinc:OaFTHXfHuPHg2QQobY7ANNPHUCLemur67QJlr8VPuhw#encrypting","owner":"did:jlinc:OaFTHXfHuPHg2QQobY7ANNPHUCLemur67QJlr8VPuhw","publicKeyBase64":"sEmKAcLq00NoncO1Vb_zocG8ljPGqnprP2-Fe3Kw6S0","type":"curve25519"}]}}`})
	chaintests = append(chaintests, Chaintest{id: "did:jlinc:ZddgjpfJodYuGiSqF4MeuskzxIGYX64QGGqoxpqB-cY", did: `{"did":{"@context":"https://w3id.org/did/v1","created":"2019-01-11T01:09:30.700Z","id":"did:jlinc:ZddgjpfJodYuGiSqF4MeuskzxIGYX64QGGqoxpqB-cY","publicKey":[{"id":"did:jlinc:ZddgjpfJodYuGiSqF4MeuskzxIGYX64QGGqoxpqB-cY#signing","owner":"did:jlinc:ZddgjpfJodYuGiSqF4MeuskzxIGYX64QGGqoxpqB-cY","publicKeyBase64":"ZddgjpfJodYuGiSqF4MeuskzxIGYX64QGGqoxpqB-cY","type":"ed25519"},{"id":"did:jlinc:ZddgjpfJodYuGiSqF4MeuskzxIGYX64QGGqoxpqB-cY#encrypting","owner":"did:jlinc:ZddgjpfJodYuGiSqF4MeuskzxIGYX64QGGqoxpqB-cY","publicKeyBase64":"6KwnVz2GmKIYpVjjX9NIGeUXUoqdwD0ORPTm7sbz9Q0","type":"curve25519"}]}}`})
	chaintests = append(chaintests, Chaintest{id: "did:jlinc:0xgOByxBvORd1OOF1IHVJezPJ5aWwdpqmfLFawdNG80", did: `{"did":{"@context":"https://w3id.org/did/v1","created":"2019-01-11T01:09:34.325Z","id":"did:jlinc:0xgOByxBvORd1OOF1IHVJezPJ5aWwdpqmfLFawdNG80","publicKey":[{"id":"did:jlinc:0xgOByxBvORd1OOF1IHVJezPJ5aWwdpqmfLFawdNG80#signing","owner":"did:jlinc:0xgOByxBvORd1OOF1IHVJezPJ5aWwdpqmfLFawdNG80","publicKeyBase64":"0xgOByxBvORd1OOF1IHVJezPJ5aWwdpqmfLFawdNG80","type":"ed25519"},{"id":"did:jlinc:0xgOByxBvORd1OOF1IHVJezPJ5aWwdpqmfLFawdNG80#encrypting","owner":"did:jlinc:0xgOByxBvORd1OOF1IHVJezPJ5aWwdpqmfLFawdNG80","publicKeyBase64":"La6awJhb94UJZJtJPPgQStLRG3uSkDO0Q2Pr7rfYuBs","type":"curve25519"}]}}`})
	chaintests = append(chaintests, Chaintest{id: "did:jlinc:0KGfPoNPPO3mwvbZzXNwjnwnSAsaZtEt5dU6OksMCZg", did: `{"did":{"@context":"https://w3id.org/did/v1","created":"2019-01-11T01:09:38.943Z","id":"did:jlinc:0KGfPoNPPO3mwvbZzXNwjnwnSAsaZtEt5dU6OksMCZg","publicKey":[{"id":"did:jlinc:0KGfPoNPPO3mwvbZzXNwjnwnSAsaZtEt5dU6OksMCZg#signing","owner":"did:jlinc:0KGfPoNPPO3mwvbZzXNwjnwnSAsaZtEt5dU6OksMCZg","publicKeyBase64":"0KGfPoNPPO3mwvbZzXNwjnwnSAsaZtEt5dU6OksMCZg","type":"ed25519"},{"id":"did:jlinc:0KGfPoNPPO3mwvbZzXNwjnwnSAsaZtEt5dU6OksMCZg#encrypting","owner":"did:jlinc:0KGfPoNPPO3mwvbZzXNwjnwnSAsaZtEt5dU6OksMCZg","publicKeyBase64":"N41R9KZivnQThUOa9KiEbcdrSpk1STx_sxpjPKDYUEA","type":"curve25519"}]}}`})
	chaintests = append(chaintests, Chaintest{id: "did:jlinc:w3WxbFEZnMgZdvqP6bSBStrKMlTzib3zXmmmprEJEyw", did: `{"did":{"@context":"https://w3id.org/did/v1","created":"2019-01-11T01:09:40.661Z","id":"did:jlinc:w3WxbFEZnMgZdvqP6bSBStrKMlTzib3zXmmmprEJEyw","publicKey":[{"id":"did:jlinc:w3WxbFEZnMgZdvqP6bSBStrKMlTzib3zXmmmprEJEyw#signing","owner":"did:jlinc:w3WxbFEZnMgZdvqP6bSBStrKMlTzib3zXmmmprEJEyw","publicKeyBase64":"w3WxbFEZnMgZdvqP6bSBStrKMlTzib3zXmmmprEJEyw","type":"ed25519"},{"id":"did:jlinc:w3WxbFEZnMgZdvqP6bSBStrKMlTzib3zXmmmprEJEyw#encrypting","owner":"did:jlinc:w3WxbFEZnMgZdvqP6bSBStrKMlTzib3zXmmmprEJEyw","publicKeyBase64":"dzXQLM6C6hUp_F0pPxLE9BxvUGQI-w46FkbId1hvhQs","type":"curve25519"}]}}`})
	chaintests = append(chaintests, Chaintest{id: "did:jlinc:k1yRmF30QbSUAhzNPj_3xSVpHt9pHiTUlkEJvPY5P6k", did: `{"did":{"@context":"https://w3id.org/did/v1","created":"2019-01-11T01:09:48.241Z","id":"did:jlinc:k1yRmF30QbSUAhzNPj_3xSVpHt9pHiTUlkEJvPY5P6k","publicKey":[{"id":"did:jlinc:k1yRmF30QbSUAhzNPj_3xSVpHt9pHiTUlkEJvPY5P6k#signing","owner":"did:jlinc:k1yRmF30QbSUAhzNPj_3xSVpHt9pHiTUlkEJvPY5P6k","publicKeyBase64":"k1yRmF30QbSUAhzNPj_3xSVpHt9pHiTUlkEJvPY5P6k","type":"ed25519"},{"id":"did:jlinc:k1yRmF30QbSUAhzNPj_3xSVpHt9pHiTUlkEJvPY5P6k#encrypting","owner":"did:jlinc:k1yRmF30QbSUAhzNPj_3xSVpHt9pHiTUlkEJvPY5P6k","publicKeyBase64":"7ummXTmrwz4T-nBSkSh7QPHOwZGbdb9nHXDE-R283Ds","type":"curve25519"}]}}`})
	chaintests = append(chaintests, Chaintest{id: "did:jlinc:1K7I-1TPKn2BdRxsq9Wls5gGUDW978bEqMiMqNdQfVI", did: `{"did":{"@context":"https://w3id.org/did/v1","created":"2019-01-11T01:09:50.691Z","id":"did:jlinc:1K7I-1TPKn2BdRxsq9Wls5gGUDW978bEqMiMqNdQfVI","publicKey":[{"id":"did:jlinc:1K7I-1TPKn2BdRxsq9Wls5gGUDW978bEqMiMqNdQfVI#signing","owner":"did:jlinc:1K7I-1TPKn2BdRxsq9Wls5gGUDW978bEqMiMqNdQfVI","publicKeyBase64":"1K7I-1TPKn2BdRxsq9Wls5gGUDW978bEqMiMqNdQfVI","type":"ed25519"},{"id":"did:jlinc:1K7I-1TPKn2BdRxsq9Wls5gGUDW978bEqMiMqNdQfVI#encrypting","owner":"did:jlinc:1K7I-1TPKn2BdRxsq9Wls5gGUDW978bEqMiMqNdQfVI","publicKeyBase64":"Az8lKQngubEA88hNRVH3Rqq8zoYQ8mZYRsLrexX1TwU","type":"curve25519"}]}}`})
	chaintests = append(chaintests, Chaintest{id: "did:jlinc:Ptw1kBowYCq0-FKQ2qMcaaD7lMFPc9TogUNmS16ed5Q", did: `{"did":{"@context":"https://w3id.org/did/v1","created":"2019-01-11T01:09:57.910Z","id":"did:jlinc:Ptw1kBowYCq0-FKQ2qMcaaD7lMFPc9TogUNmS16ed5Q","publicKey":[{"id":"did:jlinc:Ptw1kBowYCq0-FKQ2qMcaaD7lMFPc9TogUNmS16ed5Q#signing","owner":"did:jlinc:Ptw1kBowYCq0-FKQ2qMcaaD7lMFPc9TogUNmS16ed5Q","publicKeyBase64":"Ptw1kBowYCq0-FKQ2qMcaaD7lMFPc9TogUNmS16ed5Q","type":"ed25519"},{"id":"did:jlinc:Ptw1kBowYCq0-FKQ2qMcaaD7lMFPc9TogUNmS16ed5Q#encrypting","owner":"did:jlinc:Ptw1kBowYCq0-FKQ2qMcaaD7lMFPc9TogUNmS16ed5Q","publicKeyBase64":"dlrW7Ywm4-E3Drod-mKP1rs4zN4F3kMlvrQufDLskiI","type":"curve25519"}]}}`})
	chaintests = append(chaintests, Chaintest{id: "did:jlinc:gqP2hNjQ7a1TBPPEeTpwyFe9kMF5iym3Lq_qk1XNWKA", did: `{"did":{"@context":"https://w3id.org/did/v1","created":"2019-01-11T01:09:59.264Z","id":"did:jlinc:gqP2hNjQ7a1TBPPEeTpwyFe9kMF5iym3Lq_qk1XNWKA","publicKey":[{"id":"did:jlinc:gqP2hNjQ7a1TBPPEeTpwyFe9kMF5iym3Lq_qk1XNWKA#signing","owner":"did:jlinc:gqP2hNjQ7a1TBPPEeTpwyFe9kMF5iym3Lq_qk1XNWKA","publicKeyBase64":"gqP2hNjQ7a1TBPPEeTpwyFe9kMF5iym3Lq_qk1XNWKA","type":"ed25519"},{"id":"did:jlinc:gqP2hNjQ7a1TBPPEeTpwyFe9kMF5iym3Lq_qk1XNWKA#encrypting","owner":"did:jlinc:gqP2hNjQ7a1TBPPEeTpwyFe9kMF5iym3Lq_qk1XNWKA","publicKeyBase64":"6hF3zqFy52gr_nZO_60uBaubmXcjQ0NYJcbiEaX2gx8","type":"curve25519"}]}}`})
	chaintests = append(chaintests, Chaintest{id: "did:jlinc:_-1yvssDomlFcpWUZ0IjDvstl9SKX0JsSEx1G2wJqvQ", did: `{"did":{"@context":"https://w3id.org/did/v1","created":"2019-01-11T01:10:02.592Z","id":"did:jlinc:_-1yvssDomlFcpWUZ0IjDvstl9SKX0JsSEx1G2wJqvQ","publicKey":[{"id":"did:jlinc:_-1yvssDomlFcpWUZ0IjDvstl9SKX0JsSEx1G2wJqvQ#signing","owner":"did:jlinc:_-1yvssDomlFcpWUZ0IjDvstl9SKX0JsSEx1G2wJqvQ","publicKeyBase64":"_-1yvssDomlFcpWUZ0IjDvstl9SKX0JsSEx1G2wJqvQ","type":"ed25519"},{"id":"did:jlinc:_-1yvssDomlFcpWUZ0IjDvstl9SKX0JsSEx1G2wJqvQ#encrypting","owner":"did:jlinc:_-1yvssDomlFcpWUZ0IjDvstl9SKX0JsSEx1G2wJqvQ","publicKeyBase64":"5WR63q1YNjhy4Z_iI-n1iSjmmhCRGjHM_EBMpq06dCo","type":"curve25519"}]}}`})
	chaintests = append(chaintests, Chaintest{id: "did:jlinc:x-7xcRHrhXzIXVzLdPevDvgExd5j0R3n0hjTW5x1v7M", did: `{"did":{"@context":"https://w3id.org/did/v1","created":"2019-01-11T01:10:07.525Z","id":"did:jlinc:x-7xcRHrhXzIXVzLdPevDvgExd5j0R3n0hjTW5x1v7M","publicKey":[{"id":"did:jlinc:x-7xcRHrhXzIXVzLdPevDvgExd5j0R3n0hjTW5x1v7M#signing","owner":"did:jlinc:x-7xcRHrhXzIXVzLdPevDvgExd5j0R3n0hjTW5x1v7M","publicKeyBase64":"x-7xcRHrhXzIXVzLdPevDvgExd5j0R3n0hjTW5x1v7M","type":"ed25519"},{"id":"did:jlinc:x-7xcRHrhXzIXVzLdPevDvgExd5j0R3n0hjTW5x1v7M#encrypting","owner":"did:jlinc:x-7xcRHrhXzIXVzLdPevDvgExd5j0R3n0hjTW5x1v7M","publicKeyBase64":"W0eQrf8_jKsr0JTxPpkwS2DO93_91dozFuwwYWC2iW4","type":"curve25519"}]}}`})
	chaintests = append(chaintests, Chaintest{id: "did:jlinc:wWEqnRzC6JURevvh58y8FrSkaRVZ2HvjYnVpBHjRvMI", did: `{"did":{"@context":"https://w3id.org/did/v1","created":"2019-01-11T01:10:09.667Z","id":"did:jlinc:wWEqnRzC6JURevvh58y8FrSkaRVZ2HvjYnVpBHjRvMI","publicKey":[{"id":"did:jlinc:wWEqnRzC6JURevvh58y8FrSkaRVZ2HvjYnVpBHjRvMI#signing","owner":"did:jlinc:wWEqnRzC6JURevvh58y8FrSkaRVZ2HvjYnVpBHjRvMI","publicKeyBase64":"wWEqnRzC6JURevvh58y8FrSkaRVZ2HvjYnVpBHjRvMI","type":"ed25519"},{"id":"did:jlinc:wWEqnRzC6JURevvh58y8FrSkaRVZ2HvjYnVpBHjRvMI#encrypting","owner":"did:jlinc:wWEqnRzC6JURevvh58y8FrSkaRVZ2HvjYnVpBHjRvMI","publicKeyBase64":"i7B_5UPW3Ef8JfrEVcytwrV7IFkiS3bdpgLPU_XKXgk","type":"curve25519"}]}}`})
	chaintests = append(chaintests, Chaintest{id: "did:jlinc:hhqRQKNzfy2uxdP4wS2jBpVODTCUKJOFBwdW3aUKvDM", did: `{"did":{"@context":"https://w3id.org/did/v1","created":"2019-01-11T01:10:11.745Z","id":"did:jlinc:hhqRQKNzfy2uxdP4wS2jBpVODTCUKJOFBwdW3aUKvDM","publicKey":[{"id":"did:jlinc:hhqRQKNzfy2uxdP4wS2jBpVODTCUKJOFBwdW3aUKvDM#signing","owner":"did:jlinc:hhqRQKNzfy2uxdP4wS2jBpVODTCUKJOFBwdW3aUKvDM","publicKeyBase64":"hhqRQKNzfy2uxdP4wS2jBpVODTCUKJOFBwdW3aUKvDM","type":"ed25519"},{"id":"did:jlinc:hhqRQKNzfy2uxdP4wS2jBpVODTCUKJOFBwdW3aUKvDM#encrypting","owner":"did:jlinc:hhqRQKNzfy2uxdP4wS2jBpVODTCUKJOFBwdW3aUKvDM","publicKeyBase64":"tvwl83lpOEHjKRv_Ynkn5OuC1uUV-Q7YpkhvYp52gGM","type":"curve25519"}]}}`})
	chaintests = append(chaintests, Chaintest{id: "did:jlinc:xuyNHGXqZQdDwA1iUohEkZ3X7psg44rEIKIWG6pW3rM", did: `{"did":{"@context":"https://w3id.org/did/v1","created":"2019-01-11T01:10:18.224Z","id":"did:jlinc:xuyNHGXqZQdDwA1iUohEkZ3X7psg44rEIKIWG6pW3rM","publicKey":[{"id":"did:jlinc:xuyNHGXqZQdDwA1iUohEkZ3X7psg44rEIKIWG6pW3rM#signing","owner":"did:jlinc:xuyNHGXqZQdDwA1iUohEkZ3X7psg44rEIKIWG6pW3rM","publicKeyBase64":"xuyNHGXqZQdDwA1iUohEkZ3X7psg44rEIKIWG6pW3rM","type":"ed25519"},{"id":"did:jlinc:xuyNHGXqZQdDwA1iUohEkZ3X7psg44rEIKIWG6pW3rM#encrypting","owner":"did:jlinc:xuyNHGXqZQdDwA1iUohEkZ3X7psg44rEIKIWG6pW3rM","publicKeyBase64":"-BhxkI1mvxqpCd5ZDcxL_iABUdklR7oOR4I5ddNk32I","type":"curve25519"}]}}`})

	if _, err := toml.DecodeFile("./test.config.toml", &Conf); err != nil {
		log.Fatal(err)
		return
	}
	connStr := Conf.Database.ConnectionString
	var err error

	DB, err = sql.Open("postgres", connStr)
	defer DB.Close()
	if err != nil {
		log.Fatal(err)
		return
	}

	for _, c := range chaintests {
		if err := addChainlink(c.id, c.did); err != nil {
			t.Errorf("Chainlink error: %v", err)
		}
	}

	res, err := DB.Exec("DELETE FROM chainlinks")
	if err != nil {
		log.Fatal(err)
		return
	}
	numrows, _ := res.RowsAffected()
	if int(numrows) != len(chaintests) {
		t.Errorf("Chainlink wanted: %d got %d", len(chaintests), numrows)
	}
}
